'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
function StorageProvider() {
  var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};

  var cachedProvider = null;

  options.json = 'json' in options ? options.json : true;
  options.prefix = options.prefix ? options.prefix + '.' : '';

  function createProvider(context) {
    var target = options.target;

    if (options.sync) {
      context.controller.on('flush', function (changes) {
        changes.forEach(function (change) {
          Object.keys(options.sync).forEach(function (syncKey) {
            if (change.path.join('.').indexOf(options.sync[syncKey]) === 0) {
              var value = context.controller.getState(options.sync[syncKey]);

              target.setItem(options.prefix + syncKey, options.json ? JSON.stringify(value) : value);
            }
          });
        });
      });
    }

    return {
      get: function get(key) {
        var value = target.getItem(options.prefix + key);

        if (options.json && value) {
          return JSON.parse(value);
        }

        return value;
      },
      set: function set(key, value) {
        target.setItem(options.prefix + key, options.json ? JSON.stringify(value) : value);
      },
      remove: function remove(key) {
        target.removeItem(options.prefix + key);
      }
    };
  }

  return function (context) {
    context.storage = cachedProvider = cachedProvider || createProvider(context);

    if (context.debugger) {
      context.debugger.wrapProvider('storage');
    }

    return context;
  };
}

exports.default = StorageProvider;
//# sourceMappingURL=index.js.map