{"version":3,"sources":["../src/utils.js"],"names":["createResponse","mergeWith","urlEncode","convertObjectWithTemplates","parseHeaders","processResponse","getAllResponseHeaders","options","resolve","reject","event","type","onResponse","currentTarget","onProgress","lengthComputable","progress","Number","loaded","total","toFixed","status","optionsA","optionsB","Object","keys","reduce","newOptions","key","obj","prefix","str","p","hasOwnProperty","k","v","push","encodeURIComponent","join","isTag","value","convertedObject","rawHeaders","headerPairs","replace","split","parsedHeaders","headerPair","index","indexOf","substr","trim","toLowerCase","httpAction","path","then","response","success","catch","error","isAborted","abort","toJSON","xhr"],"mappings":"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","file":"utils.js","sourcesContent":["import HttpProviderError from './HttpProviderError'\n\nexport function createResponse(options, resolve, reject) {\n  return event => {\n    switch (event.type) {\n      case 'load':\n        return options.onResponse(event.currentTarget, resolve, reject)\n      case 'progress':\n        if (options.onProgress && event.lengthComputable) {\n          options.onProgress({\n            progress: Number(event.loaded / event.total).toFixed(0),\n          })\n        }\n        break\n      case 'error':\n        reject(\n          new HttpProviderError(\n            event.currentTarget.status,\n            null,\n            null,\n            'request error'\n          )\n        )\n        break\n      case 'abort':\n        reject(\n          new HttpProviderError(\n            event.currentTarget.status,\n            null,\n            null,\n            'request abort',\n            true\n          )\n        )\n        break\n    }\n  }\n}\n\nexport function mergeWith(optionsA, optionsB) {\n  return Object.keys(optionsB).reduce((newOptions, key) => {\n    if (!newOptions[key]) {\n      newOptions[key] = optionsB[key]\n    } else if (key === 'headers') {\n      newOptions[key] = mergeWith(newOptions[key], optionsB[key] || {})\n    }\n\n    return newOptions\n  }, optionsA)\n}\n\nexport function urlEncode(obj, prefix) {\n  var str = []\n\n  for (var p in obj) {\n    if (obj.hasOwnProperty(p)) {\n      var k = prefix ? prefix + '[' + p + ']' : p\n      var v = obj[p]\n\n      str.push(\n        typeof v === 'object'\n          ? urlEncode(v, k)\n          : encodeURIComponent(k) + '=' + encodeURIComponent(v)\n      )\n    }\n  }\n  return str.join('&')\n}\n\nexport function convertObjectWithTemplates(obj, resolve) {\n  if (resolve.isTag(obj)) {\n    return resolve.value(obj)\n  }\n\n  return Object.keys(obj).reduce((convertedObject, key) => {\n    convertedObject[key] = resolve.value(obj[key])\n    return convertedObject\n  }, {})\n}\n\nexport function parseHeaders(rawHeaders) {\n  const headerPairs = rawHeaders.replace(/\\r?\\n$/, '').split(/\\r?\\n/)\n\n  return headerPairs.reduce((parsedHeaders, headerPair) => {\n    const index = headerPair.indexOf(':')\n    const key = headerPair.substr(0, index).trim().toLowerCase()\n    const value = headerPair.substr(index + 1).trim()\n    if (key) {\n      parsedHeaders[key] = parsedHeaders[key]\n        ? parsedHeaders[key] + ', ' + value\n        : value\n    }\n\n    return parsedHeaders\n  }, {})\n}\n\nexport function processResponse(httpAction, path) {\n  return (\n    httpAction\n      .then(response => {\n        if (path && path[response.status]) {\n          return path[response.status](response)\n        }\n\n        return path && path.success ? path.success(response) : response\n      })\n      // This error will be an instance of HttpError\n      .catch(error => {\n        if (!path) {\n          throw error\n        }\n\n        if (error.isAborted && path.abort) {\n          return path.abort({ error: error.toJSON() })\n        }\n\n        if (path[error.status]) {\n          return path[error.status]({ error: error.toJSON() })\n        }\n\n        if (path.error) {\n          return path.error({ error: error.toJSON() })\n        }\n\n        throw error\n      })\n  )\n}\n\nexport function getAllResponseHeaders(xhr) {\n  return 'getAllResponseHeaders' in xhr\n    ? parseHeaders(xhr.getAllResponseHeaders())\n    : null\n}\n"]}